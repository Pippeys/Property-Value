---
title: "Hordan"
output:
  html_notebook: default
  html_document: default
---

# load data 
```{r echo = T, eval=T, warning=FALSE}
library(ggplot2)
library(psych)
library(car)
library(FactoMineR)
library(corrgram)
library(tidyverse)
library(stringr)

Master_Zipper_gud <- read_csv("Property Value/Master_Zipper_gud.csv", col_types = cols(SaleDate = col_date(format = "%m/%d/%Y")))
```
What does the data look like? Switch some Variable types
```{r}
#Master_Zipper_gud$Type <- factor(Master_Zipper_gud$Type)
#Master_Zipper_gud$Age <- is.factor(Master_Zipper_gud$Age)
#Master_Zipper_gud$BuildingCondition <- is.factor(Master_Zipper_gud$BuildingCondition)
#Master_Zipper_gud$BuildingClass <- is.factor(Master_Zipper_gud$BuildingClass)
#Master_Zipper_gud$BuildingMaterials <- is.factor(Master_Zipper_gud$BuildingMaterials)
#Master_Zipper_gud$Floors <- is.factor(Master_Zipper_gud$Floors)
#Master_Zipper_gud$ZipCode <- is.factor(Master_Zipper_gud$ZipCode)
#Master_Zipper_gud$Zoning <- is.factor(Master_Zipper_gud$Zoning)
#Master_Zipper_gud$Rating <- as.ordered(Master_Zipper_gud$Rating)
#Master_Zipper_gud$SaleCondition <- is.factor(Master_Zipper_gud$SaleCondition)
#Master_Zipper_gud$YearBuilt <- is.factor(Master_Zipper_gud$YearBuilt)

head(Master_Zipper_gud)
summary(Master_Zipper_gud)
```

#Cleaning

Removing NAs, and giving correct data where NA is inappropiate. Switch some Variable types
```{r}
Bay_Area <- Master_Zipper_gud %>% 
  filter(!is.na(Address) & !is.na(Type) & !is.na(SaleDate) & !is.na(SalePrice) & !is.na(GRM) & !is.na(Cap) & !is.na(PricePerSF) & !is.na(PricePerUnit) & !is.na(BldgSF) & !is.na(NumberOfUnits) & !is.na(Age) & !is.na(BuildingCondition) & !is.na(BuildingClass) & !is.na(BuildingMaterials) & !is.na(Latitude) & !is.na(Longitude) & !is.na(Floors) & !is.na(ZipCode) & !is.na(Rating) & !is.na(Vacancy) & !is.na(Zoning) & !is.na(SaleCondition) & !is.na(YearBuilt))
```

Lets look at the difference without NAs
```{r}
dim(Master_Zipper_gud)[1]
dim(Bay_Area)[1]

```

#Data Exploration
Vacancy, NumberOfUnits, Floors need to be changed to factor/char/ordered/nominal
```{r}
Bay_Area %>% 
  ggplot(aes(x = SalePrice)) +
  geom_histogram()

Bay_Area %>%   
  ggplot(aes(x = GRM)) +
  geom_histogram()

Bay_Area %>% 
  ggplot(aes(x = Cap)) +
  geom_histogram()

Bay_Area %>% 
  ggplot(aes(x = PricePerSF)) +
  geom_histogram()

Bay_Area %>% 
  ggplot(aes(x = PricePerUnit)) +
  geom_histogram()

Bay_Area %>% 
  ggplot(aes(x = BldgSF)) +
  geom_histogram()

Bay_Area %>% 
  ggplot(aes(x = NumberOfUnits)) +
  geom_histogram()

Bay_Area %>% 
  ggplot(aes(x = Vacancy)) +
  geom_histogram()

Bay_Area %>% 
  ggplot(aes(x = BuildingCondition)) +
  geom_bar()

Bay_Area %>% 
  ggplot(aes(x = BuildingMaterials)) +
  geom_bar()

Bay_Area %>% 
  ggplot(aes(x = BuildingClass)) +
  geom_bar()

Bay_Area %>% 
  ggplot(aes(x = Rating)) +
  geom_bar()

Bay_Area %>% 
  ggplot(aes(x = ZipCode)) +
  geom_bar()

Bay_Area %>% 
  ggplot(aes(x = SaleCondition)) +
  geom_bar()

Bay_Area %>% 
  ggplot(aes(x = YearBuilt)) +
  geom_bar()

Bay_Area %>% 
  ggplot(aes(x = Floors)) +
  geom_histogram()
```
A few of these variable might need to be discarded, and some will need transformation (most like nature log)
discard:vacancy
Transform:Price,p/sq, p/u, BldgSF, num of units, Age (parabola?), floors

```{r}
Bay_Area['Trans_SalePrice'] <- NA
Bay_Area['Trans_PricePerSF'] <- NA
Bay_Area['Trans_PricePerUnit'] <- NA
Bay_Area['Trans_BldgSF'] <- NA
Bay_Area['Trans_NumberOfUnits'] <- NA
Bay_Area['Trans_Floors'] <- NA
Bay_Area$Trans_SalePrice <- log(Bay_Area$SalePrice) 
Bay_Area$Trans_PricePerSF <- log(Bay_Area$PricePerSF) 
Bay_Area$Trans_PricePerUnit <- log(Bay_Area$PricePerUnit) 
Bay_Area$Trans_BldgSF <- log(Bay_Area$BldgSF) 
Bay_Area$Trans_NumberOfUnits <- log(log(Bay_Area$NumberOfUnits))
Bay_Area$Trans_Floors <- log(Bay_Area$Floors) 


Bay_Area %>% 
  ggplot(aes(x = Trans_SalePrice)) +
  geom_histogram()

Bay_Area %>% 
  ggplot(aes(x = Trans_PricePerSF)) +
  geom_histogram()

Bay_Area %>% 
  ggplot(aes(x = Trans_PricePerUnit)) +
  geom_histogram()

Bay_Area %>% 
  ggplot(aes(x = Trans_BldgSF)) +
  geom_histogram()

Bay_Area %>% 
  ggplot(aes(x = Trans_NumberOfUnits)) +
  geom_histogram()
```


###With Sale Price as the dependent variable,
###How correlated are the independent variables to it?

```{r}
sapply(Bay_Area, is.factor)
```
Remove Large NA columns for correlation graph
```{r}
sapply(Bay_Area, is.numeric)


cor_BA <- cbind.data.frame(Bay_Area$Trans_SalePrice, Bay_Area$Trans_BldgSF, Bay_Area$Trans_NumberOfUnits, Bay_Area$GRM, Bay_Area$Cap)
```



#Regression Models
```{r}
corrgram(x = cor_BA, type = 'data', order= FALSE, lower.panel=panel.pts,
  upper.panel=panel.ellipse, text.panel=panel.txt,
  diag.panel=panel.minmax) 

scatterplotMatrix(cor_BA)
```

Number of Units and GRM/Cap/Age is abnormal because NoU is actually cateogical

```{r}
Bay_Area %>% 
  ggplot(aes(x = GRM, y = Trans_SalePrice)) +
  geom_point() +
  geom_smooth()

Bay_Area %>% 
  ggplot(aes(x = Cap, y = Trans_SalePrice)) +
  geom_point() +
  geom_smooth()

Bay_Area %>% 
  ggplot(aes(x = Trans_BldgSF, y = Trans_SalePrice)) +
  geom_point() +
  geom_smooth()

Bay_Area %>% 
  ggplot(aes(x = Trans_NumberOfUnits, y = Trans_SalePrice)) +
  geom_point() +
  geom_smooth()

```


```{r}
sapply(Bay_Area, is.character)
unique(Bay_Area$ZipCode)
```
####There is 2 ways I can think of running a good regression model over the Bay Area's wide range of properties. 
1. Do a full regression model with all I.V. and their levels.
2. Do a regression model for each ZipCode, giving precise analysis on each Zip.
3. A 3rd way might be to do a conditional statement: if(zipcode = True, use filter(by zip, lm()), else: use broad lm())
```{r}
Bay_Area 
anova_Bclass <- step(lm(Bay_Area$Trans_SalePrice ~ Bay_Area$BuildingMaterials + Bay_Area$BuildingCondition + Bay_Area$Trans_BldgSF + Bay_Area$NumberOfUnits + Bay_Area$Floors * Bay_Area$ZipCode + Bay_Area$Cap + Bay_Area$GRM))
aov(anova_Bclass)
summary(anova_Bclass)
```

